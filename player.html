<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TV4WAP Live Player</title>

<!-- Shaka Player -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.6.0/shaka-player.ui.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.6.0/controls.min.css">

<style>
  html, body {
    margin: 0; padding: 0; height: 100%; width: 100%;
    background: #000; overflow: hidden;
  }
  .shaka-video-container { width: 100%; height: 100%; position: absolute; }
  video { width: 100%; height: 100%; object-fit: contain; background: #000; }
  #manualPlayButton {
    position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255, 0, 0, 0.8);
    color: #fff; padding: 15px 25px;
    border-radius: 8px; cursor: pointer;
    font-size: 18px; display: none;
  }
  #myLogo {
    width: 60px; height: 40px;
    position: absolute; right: 10px; top: 10px;
    z-index: 1000;
  }
</style>
</head>

<body>
  <div class="shaka-video-container youtube-theme">
    <video autoplay muted playsinline></video>
    <img id="myLogo" src="https://blogger.googleusercontent.com/img/a/AVvXsEiQ92h-ekVYskxW9qCgLvpQVMpAs4tqUQXnH9nDi37JW5B95V7Cq2Rz_mlGO68vTZmA2H5Qp4p8B0I9EUlW-6W1aVOZgITWN3xyE65Hd6G5G_D6HJFxiuXJaK-wMfYD0PiiUR9EBodkzuPH0-ubAMJQK_3F3rpDMEIJKCxlEzNZucpRzsumlBFXWqinGOw=s885">
    <div id="manualPlayButton">â–¶ Tap to Play</div>
  </div>

<script>
function getParam(name) {
  const params = new URLSearchParams(window.location.search);
  return params.get(name);
}

const mpd = getParam('mpd');
const keyId = getParam('keyId');
const key = getParam('key');

document.addEventListener('DOMContentLoaded', async () => {
  shaka.polyfill.installAll();
  const video = document.querySelector('video');
  const player = new shaka.Player(video);

  // UI Setup
  const container = document.querySelector('.shaka-video-container');
  const ui = new shaka.ui.Overlay(player, container, video);
  ui.configure({
    controlPanelElements: ['play_pause','time_and_duration','mute','volume','spacer','quality','fullscreen']
  });

  player.addEventListener('error', e => console.error('Error:', e.detail));

  try {
    if (!mpd) {
      alert('No MPD or stream URL found!');
      return;
    }

    // Handle ClearKey DRM if present
    if (keyId && key) {
      player.configure({
        drm: {
          clearKeys: {
            [keyId]: key
          }
        }
      });
    }

    console.log('Loading:', mpd);
    await player.load(mpd);
    console.log('Stream loaded.');

    // Autoplay attempt
    video.muted = true;
    await video.play().catch(() => {
      document.getElementById('manualPlayButton').style.display = 'block';
    });

  } catch (err) {
    console.error('Playback error:', err);
    document.getElementById('manualPlayButton').style.display = 'block';
  }

  // Manual play handler
  document.getElementById('manualPlayButton').addEventListener('click', async () => {
    try {
      video.muted = false;
      await video.play();
      document.getElementById('manualPlayButton').style.display = 'none';
    } catch (err) {
      console.error('Manual play failed:', err);
    }
  });
});
</script>
</body>
</html>
